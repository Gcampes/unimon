function Game(socket){var _io=socket,_stage=this.STAGE_INPUTNAME,$roomList=$("#roomList");this.init=function(){this.goToStage(_stage)},this.listRooms=function(){$.get("/rooms",function(data){var pattern='<tr><td>%s</td><td>%s</td><td>%s</td><td><button data-action="join-room" data-param="%s" type="button" class="btn btn-default btn-xs">Entrar</button></td></tr>',newContent="";data.length>0?$.each(data,function(i,row){var rowStr=pattern.replace("%s",row.ref).replace("%s",row.name).replace("%s",row.count).replace("%s",row.ref);newContent+=rowStr}):newContent='<tr><td colspan="3">Nenhum campo disponível</td></tr>',$roomList.html(newContent)})},this.newRoom=function(name){$.post("/rooms",{name:name},this.listRooms)},this.joinRoom=function(id){_io.emit("join",{roomId:id})},this.inputPlayerName=function(name){_io.emit("inputPlayerName",{playerName:name}),Game.listRooms(),Game.goToStage(this.STAGE_LISTROOMS)},this.goToStage=function(stageName){$(".game-stage").hide(),$("#"+stageName).show()},this.startGame=function(data){data.players.you,data.players.other},this.round=function(){_io.emit("roundPlayerAttack")},this.roomInfo=function(data){$("#room-name").text(data.room.name);var you=data.players.you,other=data.players.other;if($("#player-"+(you.position+1)+"-name").text(you.player.name),null!=other)$("#player-"+(other.position+1)+"-name").text(other.player.name),$("#player-"+(you.position+1)+"-name").parent().find("span").text(you.player.hp),$("#player-"+(other.position+1)+"-name").parent().find("span").text(other.player.hp),$("#player-"+(you.position+1)+"-name").parent().find("p").show(),$("#player-"+(other.position+1)+"-name").parent().find("p").hide(),Game.startGame(data);else{var pos=you.position+1==1?2:1;$("#player-"+pos+"-name").text("( aguardando adversário )")}$("#stage-room").find("button").attr("disabled","disabled"),$("#player-"+(data.room.currentPlayer+1)+"-name").parent().find("button").removeAttr("disabled")},this.init()}var socket=io.connect("http://10.30.10.200:1337/"),Game=new Game(socket);$(function(){$(document).on("click","[data-action]",function(e){e.preventDefault();var _self=$(this),_action=_self.data("action"),_param=_self.data("param")||null;switch(_action){case"input-name":var playerName=_self.siblings("input[name=name]").val();Game.inputPlayerName(playerName);break;case"new-room":var inpt=_self.siblings("input[name=room-name]");Game.newRoom(inpt.val()),inpt.val(null);break;case"join-room":Game.joinRoom(_param);break;case"refresh-rooms":Game.listRooms();break;case"attack":Game.round()}}),socket.on("message",function(data){$("#log").prepend(data.message+"<br/>")}),socket.on("roomInfo",function(data){Game.goToStage(data.stage),Game.roomInfo(data)}),socket.on("changeStage",function(data){Game.goToStage(data.stage)})}),Game.prototype.STAGE_INPUTNAME="stage-inputname",Game.prototype.STAGE_LISTROOMS="stage-listrooms",Game.prototype.STAGE_ROOM="stage-room";