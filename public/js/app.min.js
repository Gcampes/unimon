function Game(socket){var _io=socket,_stage=this.STAGE_INPUTNAME,$roomList=$("#roomList");this.listRooms=function(){$.get("/rooms",function(data){var pattern='<tr><td>%s</td><td>%s</td><td>%s</td><td><button data-action="join-room" data-param="%s" type="button" class="btn btn-default btn-xs">Entrar</button></td></tr>',newContent="";data.length>0?$.each(data,function(i,row){var rowStr=pattern.replace("%s",row.ref).replace("%s",row.name).replace("%s",row.count).replace("%s",row.ref);newContent+=rowStr}):newContent='<tr><td colspan="3">Nenhum campo disponível</td></tr>',$roomList.html(newContent)})},this.newRoom=function(name){$.post("/rooms",{name:name},this.listRooms)},this.joinRoom=function(id){_io.emit("join",{roomId:id})},this.inputPlayerName=function(name){_io.emit("inputPlayerName",{playerName:name}),Game.listRooms(),Game.goToStage(this.STAGE_LISTROOMS)},this.goToStage=function(stageName){$(".game-stage").hide(),$("#"+stageName).show()},this.roomInfo=function(data){console.info("teste"),$("#room-name").text(data.room.name);var you=data.players.you,other=data.players.other;if($("#player-"+(you.position+1)+"-name").text(you.player.name),null!=other)$("#player-"+(other.position+1)+"-name").text(other.player.name);else{var pos=you.position+1==1?2:1;$("#player-"+pos+"-name").text("( aguardando adversário )")}},this.goToStage(_stage)}var socket=io.connect("http://127.0.0.1:1337/"),Game=new Game(socket);$(function(){$(document).on("click","[data-action]",function(e){e.preventDefault();var _self=$(this),_action=_self.data("action"),_param=_self.data("param")||null;switch(_action){case"input-name":var playerName=_self.siblings("input[name=name]").val();Game.inputPlayerName(playerName);break;case"new-room":var inpt=_self.siblings("input[name=room-name]");Game.newRoom(inpt.val()),inpt.val(null);break;case"join-room":Game.joinRoom(_param);break;case"refresh-rooms":Game.listRooms()}}),socket.on("message",function(data){$("#log").append(data.message+"<br/>")}),socket.on("roomInfo",function(data){Game.goToStage(data.stage),Game.roomInfo(data)})}),Game.prototype.STAGE_INPUTNAME="stage-inputname",Game.prototype.STAGE_LISTROOMS="stage-listrooms",Game.prototype.STAGE_ROOM="stage-room";